<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Danh Sách Sản Phẩm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/admin-navbar.css}" />
    <link rel="stylesheet" th:href="@{/admin-common.css}" />
    <style>
      .main-content {
        background-color: #f8f9fa;
        min-height: 100vh;
      }

      .header-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .product-table {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none !important;
        border-right: none !important;
        border-left: none !important;
        padding: 15px;
        font-weight: 600;
      }

      .table td {
        padding: 15px;
        vertical-align: middle;
        border: none !important;
        border-right: none !important;
        border-left: none !important;
        background-color: white;
      }

      .table {
        border-collapse: collapse;
        border: none !important;
      }

      .table thead th {
        border-bottom: none !important;
      }

      /* Override Bootstrap table borders completely */
      .table > :not(caption) > * > * {
        border-width: 0 !important;
      }

      .table-hover > tbody > tr:hover > * {
        border-color: transparent !important;
      }

      .product-table .table th,
      .product-table .table td {
        border: 0 !important;
        border-width: 0 !important;
        border-style: none !important;
      }

      .table tbody tr {
        background-color: white;
      }

      .table tbody tr:hover {
        background-color: white;
      }

      .btn-actions {
        display: flex;
        gap: 5px;
      }

      .btn-sm {
        padding: 5px 10px;
        font-size: 12px;
      }

      .badge {
        font-size: 0.8em;
      }

      .search-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .table td {
        text-align: left;
      }

      .table td:first-child,
      .table td:last-child {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Include Admin Navbar -->
        <div th:replace="navbar/admin-navbar :: admin-sidebar"></div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
          <div class="main-content p-4">
            <!-- Header Section -->
            <div class="header-section">
              <div class="row align-items-center">
                <div class="col">
                  <h2 class="mb-1">
                    <i class="fas fa-box-open text-primary"></i>
                    Quản lý sản phẩm
                  </h2>
                  <p class="text-muted mb-0">
                    Danh sách tất cả sản phẩm trong hệ thống
                  </p>
                </div>
                <div class="col-auto">
                  <a href="/Admin/product/add" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Thêm sản phẩm
                  </a>
                </div>
              </div>
            </div>

            <!-- Search Section -->
            <div class="search-section">
              <form th:action="@{/Admin/product}" method="get">
                <div class="row g-3">
                  <div class="col-md-3">
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="fas fa-box"></i>
                      </span>
                      <select
                        name="field"
                        class="form-select"
                        th:value="${field}"
                      >
                        <option
                          value="productName"
                          th:selected="${field == 'productName'}"
                        >
                          Tên sản phẩm
                        </option>
                        <option value="price" th:selected="${field == 'price'}">
                          Giá (<=)
                        </option>
                        <option
                          value="quantity"
                          th:selected="${field == 'quantity'}"
                        >
                          Số lượng (<=)
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="fas fa-search"></i>
                      </span>
                      <input
                        type="text"
                        name="keyword"
                        class="form-control"
                        placeholder="Tìm kiếm sản phẩm..."
                        th:value="${keyword}"
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                      Tìm kiếm
                    </button>
                  </div>
                  <div class="col-md-2">
                    <a
                      th:href="@{/Admin/product}"
                      class="btn btn-outline-secondary w-100"
                    >
                      <i class="fas fa-refresh"></i> Làm mới
                    </a>
                  </div>
                </div>

                <!-- Hidden fields for pagination -->
                <input type="hidden" name="page" value="0" />
                <input type="hidden" name="size" value="6" />
              </form>
            </div>

            <!-- Product Table -->
            <div class="product-table">
              <div class="table-responsive">
                <table class="table table-hover mb-0" style="border-collapse: collapse; border: none;">
                  <thead>
                    <tr>
                      <th style="border: none !important;">STT</th>
                      <th style="border: none !important;">Tên Sản Phẩm</th>
                      <th style="border: none !important;">Giá</th>
                      <th style="border: none !important;">CPU</th>
                      <th style="border: none !important;">Lưu trữ</th>
                      <th style="border: none !important;">Số Lượng</th>
                      <th style="border: none !important;">Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="product,l : ${productPage.content}">
                      <td style="border: none !important;">
                        <span class="badge bg-primary" th:text="${l.count}"></span>
                      </td>
                      <td style="border: none !important;">
                        <div class="d-flex align-items-center">
                          <div>
                            <div class="fw-bold" th:text="${product.productName}">Tên sản phẩm</div>
                            <small class="text-muted" 
                                   th:if="${product.description != null and !product.description.isEmpty()}"
                                   th:text="${#strings.abbreviate(product.description, 50)}"></small>
                          </div>
                        </div>
                      </td>
                      <td style="border: none !important;">
                        <span class="fw-bold text-success"
                              th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></span>
                      </td>
                      <td style="border: none !important;">
                        <span th:text="${product.cpu ?: 'N/A'}" class="text-muted"></span>
                      </td>
                      <td style="border: none !important;">
                        <span th:text="${product.memory ?: 'N/A'}" class="text-muted"></span>
                      </td>
                      <td >
                        <span th:text="${product.quantity}"></span>
                      </td>
                      <td style="border: none !important;">
                        <div class="btn-actions">
                          <button class="btn btn-sm btn-outline-primary" title="Xem chi tiết">
                            <i class="fas fa-eye"></i>
                          </button>
                          <a th:href="@{'/Admin/product/edit/' + ${product.productId}}" 
                             class="btn btn-sm btn-outline-warning" title="Chỉnh sửa">
                            <i class="fas fa-edit"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                    <!-- Empty state message -->
                    <tr th:if="${#lists.isEmpty(productPage.content)}">
                      <td colspan="7" class="text-center py-4">
                        <div class="text-muted">
                          <i class="fas fa-box-open fa-2x mb-2"></i>
                          <div th:if="${keyword != null && !keyword.isEmpty()}">
                            <h6>Không tìm thấy sản phẩm nào</h6>
                            <p class="mb-0">Thử thay đổi điều kiện tìm kiếm</p>
                          </div>
                          <div th:unless="${keyword != null && !keyword.isEmpty()}">
                            <h6>Chưa có sản phẩm nào</h6>
                            <p class="mb-0">Bắt đầu thêm sản phẩm đầu tiên</p>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Pagination -->
              <div class="d-flex justify-content-between align-items-center p-3 border-top">
                <div class="text-muted">
                  <span th:if="${keyword != null && !keyword.isEmpty()}">
                    Tìm thấy <span th:text="${productPage.totalElements}">0</span> sản phẩm
                    với từ khóa "<span th:text="${keyword}" class="text-primary"></span>"
                  </span>
                  <span th:unless="${keyword != null && !keyword.isEmpty()}">
                    Hiển thị <span th:text="${#lists.size(productPage.content)}">0</span> trên <span th:text="${productPage.totalElements}">0</span> sản phẩm
                  </span>
                  <small class="text-muted ms-2">
                    (Trang <span th:text="${productPage.number + 1}">1</span>/<span th:text="${productPage.totalPages}">1</span>)
                  </small>
                </div>
                
                <!-- Pagination Controls -->
                <nav th:if="${productPage.totalPages > 1}">
                  <ul class="pagination pagination-sm mb-0">
                  <table
                    class="table table-hover mb-0"
                    style="border-collapse: collapse; border: none"
                  >
                    <thead class="table-dark">
                      <tr>
                        <th scope="col" style="border: none !important">ID</th>
                        <th scope="col" style="border: none !important">
                          Tên Sản Phẩm
                        </th>
                        <th scope="col" style="border: none !important">Giá</th>
                        <th scope="col" style="border: none !important">CPU</th>
                        <th scope="col" style="border: none !important">
                          Lưu trữ
                        </th>
                        <th scope="col" style="border: none !important">
                          Số Lượng
                        </th>
                        <th scope="col" style="border: none !important">
                          Thao tác
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="product : ${productPage.content}">
                        <td style="border: none !important">
                          <span
                            class="badge bg-secondary"
                            th:text="${product.productId}"
                          ></span>
                        </td>
                        <td style="border: none !important">
                          <div class="d-flex align-items-center">
                            <div>
                              <div
                                class="fw-bold"
                                th:text="${product.productName}"
                              ></div>
                              <small
                                class="text-muted"
                                th:if="${product.description != null and !product.description.isEmpty()}"
                                th:text="${#strings.abbreviate(product.description, 50)}"
                              ></small>
                            </div>
                          </div>
                        </td>
                        <td style="border: none !important">
                          <span
                            class="fw-bold text-success"
                            th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
                          ></span>
                        </td>
                        <td style="border: none !important">
                          <span
                            th:text="${product.cpu ?: 'N/A'}"
                            class="text-muted"
                          ></span>
                        </td>

                        <td style="border: none !important">
                          <span
                            th:text="${product.memory ?: 'N/A'}"
                            class="text-muted"
                          ></span>
                        </td>

                        <td style="border: none !important">
                          <span
                            th:text="${product.quantity}"
                            th:class="${product.quantity > 0 ? 'badge bg-secondary' : 'badge bg-warning text-dark'}"
                          ></span>
                        </td>

                        <td style="border: none !important">
                          <div class="btn-actions">
                            <a
                              th:href="@{'/Admin/product/edit/' + ${product.productId}}"
                              class="btn btn-sm btn-outline-warning"
                              title="Chỉnh sửa"
                            >
                              <i class="fas fa-edit"></i>
                            </a>
                            <button
                              class="btn btn-sm btn-outline-primary"
                              title="Xem chi tiết"
                            >
                              <i class="fas fa-eye"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Pagination -->
            <nav
              th:if="${productPage.totalPages > 1}"
              aria-label="Product pagination"
              class="mt-4"
            >
              <ul class="pagination justify-content-center">
                <!-- First page -->
                <li
                  class="page-item"
                  th:classappend="${productPage.first} ? 'disabled'"
                >
                  <a
                    class="page-link"
                    th:href="@{/Admin/product(page=0, field=${field}, keyword=${keyword})}"
                  >
                    <i class="fas fa-angle-double-left"></i>
                  </a>
                </li>

                <!-- Previous page -->
                <li
                  class="page-item"
                  th:classappend="${productPage.first} ? 'disabled'"
                >
                  <a
                    class="page-link"
                    th:href="@{/Admin/product(page=${productPage.number - 1}, field=${field}, keyword=${keyword})}"
                  >
                    <i class="fas fa-angle-left"></i>
                  </a>
                </li>

                <!-- Page numbers -->
                <li
                  th:each="pageNum : ${#numbers.sequence(0, productPage.totalPages - 1)}"
                  class="page-item"
                  th:if="${pageNum >= productPage.number - 2 and pageNum <= productPage.number + 2}"
                  th:classappend="${pageNum == productPage.number} ? 'active'"
                >
                  <a
                    class="page-link"
                    th:href="@{/Admin/product(page=${pageNum}, field=${field}, keyword=${keyword})}"
                    th:text="${pageNum + 1}"
                  ></a>
                </li>

                <!-- Next page -->
                <li
                  class="page-item"
                  th:classappend="${productPage.last} ? 'disabled'"
                >
                  <a
                    class="page-link"
                    th:href="@{/Admin/product(page=${productPage.number + 1}, field=${field}, keyword=${keyword})}"
                  >
                    <i class="fas fa-angle-right"></i>
                  </a>
                </li>

                <!-- Last page -->
                <li
                  class="page-item"
                  th:classappend="${productPage.last} ? 'disabled'"
                >
                  <a
                    class="page-link"
                    th:href="@{/Admin/product(page=${productPage.totalPages - 1}, field=${field}, keyword=${keyword})}"
                  >
                    <i class="fas fa-angle-double-right"></i>
                  </a>
                </li>
              </ul>

              <!-- Page info -->
              <div class="text-center text-muted mt-2">
                Trang <span th:text="${productPage.number + 1}"></span> trong
                tổng số <span th:text="${productPage.totalPages}"></span> trang
                (<span th:text="${productPage.totalElements}"></span>
                sản phẩm)
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
