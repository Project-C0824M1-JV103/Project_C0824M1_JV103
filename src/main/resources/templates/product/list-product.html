<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Danh Sách Sản Phẩm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-4">
      <div class="row">
        <div class="col-12">
          <!-- Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-box-open me-2"></i>Danh Sách Sản Phẩm</h2>
            <a href="/Admin/product/add" class="btn btn-success">
              <i class="fas fa-plus me-1"></i>Thêm Sản Phẩm
            </a>
          </div>

          <!-- Thanh tìm kiếm -->
          <div class="card mb-4">
            <div class="card-body">
              <form
                th:action="@{/Admin/product/list}"
                method="get"
                class="row g-3"
              >
                <div class="col-md-3">
                  <label class="form-label">Tìm kiếm theo:</label>
                  <select name="field" class="form-select" th:value="${field}">
                    <option
                      value="productName"
                      th:selected="${field == 'productName'}"
                    >
                      Tên sản phẩm
                    </option>
                    <option value="price" th:selected="${field == 'price'}">
                      Giá (<=)
                    </option>
                    <option
                      value="quantity"
                      th:selected="${field == 'quantity'}"
                    >
                      Số lượng (<=)
                    </option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Từ khóa:</label>
                  <input
                    type="text"
                    name="keyword"
                    class="form-control"
                    th:value="${keyword}"
                    placeholder="Nhập từ khóa tìm kiếm..."
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">&nbsp;</label>
                  <div class="d-grid gap-2 d-md-flex">
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-search me-1"></i>Tìm kiếm
                    </button>
                    <a
                      href="/Admin/product/list"
                      class="btn btn-outline-secondary"
                    >
                      <i class="fas fa-refresh me-1"></i>Reset
                    </a>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Kết quả tìm kiếm -->
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <span th:if="${keyword != null and !keyword.isEmpty()}">
                    Kết quả tìm kiếm: "<span th:text="${keyword}"></span>"
                  </span>
                  <span th:unless="${keyword != null and !keyword.isEmpty()}">
                    Tất cả sản phẩm
                  </span>
                </h5>
                <span
                  class="badge bg-info"
                  th:text="${productPage.totalElements} + ' sản phẩm'"
                ></span>
              </div>
            </div>
            <div class="card-body p-0">
              <!-- Hiển thị khi không có dữ liệu -->
              <div th:if="${productPage.empty}" class="text-center py-5">
                <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                <p class="text-muted mb-3">Không tìm thấy sản phẩm nào</p>
                <a href="/Admin/product/add" class="btn btn-primary">
                  <i class="fas fa-plus me-1"></i>Thêm sản phẩm đầu tiên
                </a>
              </div>

              <!-- Bảng sản phẩm -->
              <div th:unless="${productPage.empty}" class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Tên Sản Phẩm</th>
                      <th scope="col">Giá</th>
                      <th scope="col">CPU</th>
                      <th scope="col">Lưu trữ</th>
                      <th scope="col">Số Lượng</th>
                     <th scope="col">Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="product : ${productPage.content}">
                      <td>
                        <span
                          class="badge bg-secondary"
                          th:text="${product.productId}"
                        ></span>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div>
                            <div
                              class="fw-bold"
                              th:text="${product.productName}"
                            ></div>
                            <small
                              class="text-muted"
                              th:if="${product.description != null and !product.description.isEmpty()}"
                              th:text="${#strings.abbreviate(product.description, 50)}"
                            ></small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span
                                class="fw-bold text-success"
                                th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
                        ></span>
                      </td>
                      <td>
                        <span
                          th:text="${product.cpu ?: 'N/A'}"
                          class="text-muted"
                        ></span>
                      </td>

                      <td>
                        <span
                                th:text="${product.memory ?: 'N/A'}"
                                class="text-muted"
                        ></span>
                      </td>

                      <td>
                        <span
                          th:text="${product.quantity}"
                          th:class="${product.quantity > 0 ? 'badge bg-success' : 'badge bg-warning text-dark'}"
                        ></span>
                      </td>

                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Pagination -->
          <nav
            th:if="${productPage.totalPages > 1}"
            aria-label="Product pagination"
            class="mt-4"
          >
            <ul class="pagination justify-content-center">
              <!-- First page -->
              <li
                class="page-item"
                th:classappend="${productPage.first} ? 'disabled'"
              >
                <a
                  class="page-link"
                  th:href="@{/Admin/product/list(page=0, field=${field}, keyword=${keyword})}"
                >
                  <i class="fas fa-angle-double-left"></i>
                </a>
              </li>

              <!-- Previous page -->
              <li
                class="page-item"
                th:classappend="${productPage.first} ? 'disabled'"
              >
                <a
                  class="page-link"
                  th:href="@{/Admin/product/list(page=${productPage.number - 1}, field=${field}, keyword=${keyword})}"
                >
                  <i class="fas fa-angle-left"></i>
                </a>
              </li>

              <!-- Page numbers -->
              <li
                th:each="pageNum : ${#numbers.sequence(0, productPage.totalPages - 1)}"
                class="page-item"
                th:if="${pageNum >= productPage.number - 2 and pageNum <= productPage.number + 2}"
                th:classappend="${pageNum == productPage.number} ? 'active'"
              >
                <a
                  class="page-link"
                  th:href="@{/Admin/product/list(page=${pageNum}, field=${field}, keyword=${keyword})}"
                  th:text="${pageNum + 1}"
                ></a>
              </li>

              <!-- Next page -->
              <li
                class="page-item"
                th:classappend="${productPage.last} ? 'disabled'"
              >
                <a
                  class="page-link"
                  th:href="@{/Admin/product/list(page=${productPage.number + 1}, field=${field}, keyword=${keyword})}"
                >
                  <i class="fas fa-angle-right"></i>
                </a>
              </li>

              <!-- Last page -->
              <li
                class="page-item"
                th:classappend="${productPage.last} ? 'disabled'"
              >
                <a
                  class="page-link"
                  th:href="@{/Admin/product/list(page=${productPage.totalPages - 1}, field=${field}, keyword=${keyword})}"
                >
                  <i class="fas fa-angle-double-right"></i>
                </a>
              </li>
            </ul>

            <!-- Page info -->
            <div class="text-center text-muted mt-2">
              Trang <span th:text="${productPage.number + 1}"></span> trong tổng
              số <span th:text="${productPage.totalPages}"></span> trang (<span
                th:text="${productPage.totalElements}"
              ></span>
              sản phẩm)
            </div>
          </nav>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
